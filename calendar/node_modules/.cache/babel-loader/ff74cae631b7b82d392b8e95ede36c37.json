{"ast":null,"code":"import _regeneratorRuntime from\"D:/Projects/Ciklum/Calendar_React/calendar/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"D:/Projects/Ciklum/Calendar_React/calendar/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"D:/Projects/Ciklum/Calendar_React/calendar/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Projects/Ciklum/Calendar_React/calendar/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Button,Table}from'react-bootstrap';import{useEffect,useState}from'react';import JSON5 from'json5';import{toast}from'react-toastify';import Selector from'../../components/selector/selector';import CreateEventView from'../create/creat-event-view';import{participants,daysArray,timeArray}from'../../data/calendar-data';import{eventsSingleton}from'../../sevices/API-service';import styles from'./MainView.module.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function MainView(_ref){var user=_ref.user;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),meetings=_useState2[0],setMeetings=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),meetingsByParticipant=_useState4[0],setMeetingsByParticipant=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),selectedParticipant=_useState6[0],setSelectedParticipant=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),modalShow=_useState8[0],setModalShow=_useState8[1];// open modal fn\nvar handleModalShow=function handleModalShow(){return setModalShow(true);};// close modal fn\nvar handleModalClose=function handleModalClose(){return setModalShow(false);};// sync validation form\nvar validateForm=function validateForm(participantName,eventName,day,time){if(eventName===''){toast.error('Please type event name!',{position:toast.POSITION.TOP_CENTER});return false;}if(day===''){toast.error('Please choose day!',{position:toast.POSITION.TOP_CENTER});return false;}if(time===''){toast.error('Please choose time!',{position:toast.POSITION.TOP_CENTER});return false;}if(participantName.length===0){toast.error('Please choose participant!',{position:toast.POSITION.TOP_CENTER});return false;}var isAvailableTime=meetings.filter(function(meeting){return meeting.data.info.day===day&&meeting.data.info.time===time;});if(isAvailableTime.length){toast.error('Please choose other time or date!',{position:toast.POSITION.TOP_CENTER});return false;}return true;};// submit form\nvar handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(participantName,eventName,day,time){var meeting,stringifyMeeting;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return validateForm(participantName,eventName,day,time);case 2:if(_context.sent){_context.next=4;break;}return _context.abrupt(\"return\");case 4:meeting={title:\"'\".concat(eventName,\"'\"),participants:participantName,info:{day:day,time:time}};stringifyMeeting=JSON.stringify(meeting).replace(/\"/g,'');_context.next=8;return eventsSingleton.addEvent(\"{\\n    \\\"data\\\":\\\"\".concat(stringifyMeeting,\"\\\"\\n  }\")).then(function(_ref3){var data=_ref3.data,status=_ref3.status;if(status===200){toast.success('Event succesfully added!',{position:toast.POSITION.TOP_CENTER});var parsedMeeting={id:data.id,data:JSON5.parse(data.data)};setMeetings(function(prevMeetings){return[].concat(_toConsumableArray(prevMeetings),[parsedMeeting]);});}});case 8:setModalShow(false);case 9:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x,_x2,_x3,_x4){return _ref2.apply(this,arguments);};}();// select participant fn\nvar getParticipant=function getParticipant(value){if(!value){setSelectedParticipant('');return;}setSelectedParticipant(Number(value));};// deleting event on delete button click\nvar deleteEvent=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var deleteEl,result,meetingId;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:deleteEl=event.target;if(!(deleteEl.tagName==='BUTTON')){_context2.next=7;break;}result=window.confirm(\"Are you shure you want to delete \\\"\".concat(deleteEl.parentNode.textContent,\"\\\" event?\"));if(!result){_context2.next=7;break;}meetingId=event.target.getAttribute('data-id');_context2.next=7;return eventsSingleton.deleteEvent(meetingId).then(function(status){if(status===204){toast.success('Event succesfully deleted!',{position:toast.POSITION.TOP_CENTER});deleteEl.parentNode.innerHTML='';}});case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function deleteEvent(_x5){return _ref4.apply(this,arguments);};}();// fetching meeting at first render\nuseEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _yield$eventsSingleto,data,status,parsedMeetings;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return eventsSingleton.getEvent();case 2:_yield$eventsSingleto=_context3.sent;data=_yield$eventsSingleto.data;status=_yield$eventsSingleto.status;if(!data){_context3.next=10;break;}parsedMeetings=data===null||data===void 0?void 0:data.map(function(event){return{id:event.id,data:JSON5.parse(event.data)};});setMeetings(parsedMeetings);toast.success(\"Events succesfully get with status: \".concat(status,\"!\"),{position:toast.POSITION.TOP_CENTER});return _context3.abrupt(\"return\");case 10:toast.success('There are no events in your calendar yet!',{position:toast.POSITION.TOP_CENTER});setMeetings([]);case 12:case\"end\":return _context3.stop();}}},_callee3);}));return _fetchData.apply(this,arguments);}fetchData();},[]);// filter events by selected participant\nuseEffect(function(){selectedParticipant?setMeetingsByParticipant(meetings.filter(function(meeting){return meeting.data.participants.includes(selectedParticipant);})):setMeetingsByParticipant(meetings);},[selectedParticipant,meetings]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.header,children:[/*#__PURE__*/_jsx(Selector,{selectArray:participants,onChange:getParticipant,multiple:false,selectorName:\"participant\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",disabled:!user.isAdmin,onClick:function onClick(){return handleModalShow();},children:\"Create event\"})]}),/*#__PURE__*/_jsxs(Table,{striped:true,bordered:true,hover:true,size:\"sm\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"#\"}),daysArray.map(function(day){return/*#__PURE__*/_jsx(\"th\",{children:day.name},day.id);})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:timeArray.map(function(timeObj,index){var availableMeetings=meetingsByParticipant===null||meetingsByParticipant===void 0?void 0:meetingsByParticipant.filter(function(meeting){return meeting.data.info.time===index;});var days=new Array(5).fill('');availableMeetings===null||availableMeetings===void 0?void 0:availableMeetings.map(function(meeting){var day=meeting.data.info.day;days[day]={name:\"\".concat(meeting.data.title),id:meeting.id,className:'succes'};return true;});return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:timeObj.name}),days.map(function(day,index){return/*#__PURE__*/_jsxs(\"td\",{className:styles.td,children:[day.name||'',day.name&&/*#__PURE__*/_jsx(Button,{\"data-id\":day.id,variant:\"info\",disabled:!user.isAdmin,onClick:function onClick(e){return deleteEvent(e);},className:styles.deleteBtn,children:\"x\"},day.id)]},day.id||index);})]},timeObj.id);})})]}),modalShow&&/*#__PURE__*/_jsx(CreateEventView,{modalShow:modalShow,handleSubmit:handleSubmit,handleClose:handleModalClose,controlOptions:{participants:participants,daysArray:daysArray,timeArray:timeArray}})]});}","map":{"version":3,"sources":["D:/Projects/Ciklum/Calendar_React/calendar/src/views/main/main-view.js"],"names":["Button","Table","useEffect","useState","JSON5","toast","Selector","CreateEventView","participants","daysArray","timeArray","eventsSingleton","styles","MainView","user","meetings","setMeetings","meetingsByParticipant","setMeetingsByParticipant","selectedParticipant","setSelectedParticipant","modalShow","setModalShow","handleModalShow","handleModalClose","validateForm","participantName","eventName","day","time","error","position","POSITION","TOP_CENTER","length","isAvailableTime","filter","meeting","data","info","handleSubmit","title","stringifyMeeting","JSON","stringify","replace","addEvent","then","status","success","parsedMeeting","id","parse","prevMeetings","getParticipant","value","Number","deleteEvent","event","deleteEl","target","tagName","result","window","confirm","parentNode","textContent","meetingId","getAttribute","innerHTML","fetchData","getEvent","parsedMeetings","map","includes","header","isAdmin","name","timeObj","index","availableMeetings","days","Array","fill","className","td","e","deleteBtn"],"mappings":"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","sourcesContent":["import PropTypes from 'prop-types';\r\nimport { Button, Table } from 'react-bootstrap';\r\nimport { useEffect, useState } from 'react';\r\nimport JSON5 from 'json5';\r\nimport { toast } from 'react-toastify';\r\n\r\nimport Selector from '../../components/selector/selector';\r\nimport CreateEventView from '../create/creat-event-view';\r\nimport { participants, daysArray, timeArray } from '../../data/calendar-data';\r\n\r\nimport { eventsSingleton } from '../../sevices/API-service';\r\n\r\nimport styles from './MainView.module.css';\r\n\r\nexport default function MainView({ user }) {\r\n  const [meetings, setMeetings] = useState([]);\r\n  const [meetingsByParticipant, setMeetingsByParticipant] = useState([]);\r\n  const [selectedParticipant, setSelectedParticipant] = useState('');\r\n  const [modalShow, setModalShow] = useState(false);\r\n\r\n  // open modal fn\r\n  const handleModalShow = () => setModalShow(true);\r\n\r\n  // close modal fn\r\n  const handleModalClose = () => setModalShow(false);\r\n\r\n  // sync validation form\r\n  const validateForm = (participantName, eventName, day, time) => {\r\n    if (eventName === '') {\r\n      toast.error('Please type event name!', {\r\n        position: toast.POSITION.TOP_CENTER,\r\n      });\r\n      return false;\r\n    }\r\n    if (day === '') {\r\n      toast.error('Please choose day!', {\r\n        position: toast.POSITION.TOP_CENTER,\r\n      });\r\n      return false;\r\n    }\r\n    if (time === '') {\r\n      toast.error('Please choose time!', {\r\n        position: toast.POSITION.TOP_CENTER,\r\n      });\r\n      return false;\r\n    }\r\n    if (participantName.length === 0) {\r\n      toast.error('Please choose participant!', {\r\n        position: toast.POSITION.TOP_CENTER,\r\n      });\r\n      return false;\r\n    }\r\n\r\n    const isAvailableTime = meetings.filter(\r\n      meeting =>\r\n        meeting.data.info.day === day && meeting.data.info.time === time,\r\n    );\r\n    if (isAvailableTime.length) {\r\n      toast.error('Please choose other time or date!', {\r\n        position: toast.POSITION.TOP_CENTER,\r\n      });\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  // submit form\r\n  const handleSubmit = async (participantName, eventName, day, time) => {\r\n    if (!(await validateForm(participantName, eventName, day, time))) {\r\n      return;\r\n    }\r\n    const meeting = {\r\n      title: `'${eventName}'`,\r\n      participants: participantName,\r\n      info: {\r\n        day,\r\n        time,\r\n      },\r\n    };\r\n\r\n    const stringifyMeeting = JSON.stringify(meeting).replace(/\"/g, '');\r\n    await eventsSingleton\r\n      .addEvent(\r\n        `{\r\n    \"data\":\"${stringifyMeeting}\"\r\n  }`,\r\n      )\r\n      .then(({ data, status }) => {\r\n        if (status === 200) {\r\n          toast.success('Event succesfully added!', {\r\n            position: toast.POSITION.TOP_CENTER,\r\n          });\r\n          const parsedMeeting = {\r\n            id: data.id,\r\n            data: JSON5.parse(data.data),\r\n          };\r\n          setMeetings(prevMeetings => [...prevMeetings, parsedMeeting]);\r\n        }\r\n      });\r\n    setModalShow(false);\r\n  };\r\n\r\n  // select participant fn\r\n  const getParticipant = value => {\r\n    if (!value) {\r\n      setSelectedParticipant('');\r\n      return;\r\n    }\r\n    setSelectedParticipant(Number(value));\r\n  };\r\n\r\n  // deleting event on delete button click\r\n  const deleteEvent = async event => {\r\n    const deleteEl = event.target;\r\n    if (deleteEl.tagName === 'BUTTON') {\r\n      const result = window.confirm(\r\n        `Are you shure you want to delete \"${deleteEl.parentNode.textContent}\" event?`,\r\n      );\r\n      if (result) {\r\n        const meetingId = event.target.getAttribute('data-id');\r\n\r\n        await eventsSingleton.deleteEvent(meetingId).then(status => {\r\n          if (status === 204) {\r\n            toast.success('Event succesfully deleted!', {\r\n              position: toast.POSITION.TOP_CENTER,\r\n            });\r\n            deleteEl.parentNode.innerHTML = '';\r\n          }\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  // fetching meeting at first render\r\n  useEffect(() => {\r\n    async function fetchData() {\r\n      const { data, status } = await eventsSingleton.getEvent();\r\n      if (data) {\r\n        const parsedMeetings = data?.map(event => ({\r\n          id: event.id,\r\n          data: JSON5.parse(event.data),\r\n        }));\r\n        setMeetings(parsedMeetings);\r\n        toast.success(`Events succesfully get with status: ${status}!`, {\r\n          position: toast.POSITION.TOP_CENTER,\r\n        });\r\n        return;\r\n      }\r\n      toast.success('There are no events in your calendar yet!', {\r\n        position: toast.POSITION.TOP_CENTER,\r\n      });\r\n      setMeetings([]);\r\n    }\r\n    fetchData();\r\n  }, []);\r\n\r\n  // filter events by selected participant\r\n  useEffect(() => {\r\n    selectedParticipant\r\n      ? setMeetingsByParticipant(\r\n          meetings.filter(meeting => {\r\n            return meeting.data.participants.includes(selectedParticipant);\r\n          }),\r\n        )\r\n      : setMeetingsByParticipant(meetings);\r\n  }, [selectedParticipant, meetings]);\r\n\r\n  return (\r\n    <>\r\n      <div className={styles.header}>\r\n        <Selector\r\n          selectArray={participants}\r\n          onChange={getParticipant}\r\n          multiple={false}\r\n          selectorName=\"participant\"\r\n        />\r\n        <Button\r\n          variant=\"primary\"\r\n          disabled={!user.isAdmin}\r\n          onClick={() => handleModalShow()}\r\n        >\r\n          Create event\r\n        </Button>\r\n      </div>\r\n      <Table striped bordered hover size=\"sm\">\r\n        <thead>\r\n          <tr>\r\n            <th>#</th>\r\n            {daysArray.map(day => (\r\n              <th key={day.id}>{day.name}</th>\r\n            ))}\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {timeArray.map((timeObj, index) => {\r\n            const availableMeetings = meetingsByParticipant?.filter(\r\n              meeting => meeting.data.info.time === index,\r\n            );\r\n            const days = new Array(5).fill('');\r\n            availableMeetings?.map(meeting => {\r\n              const { day } = meeting.data.info;\r\n              days[day] = {\r\n                name: `${meeting.data.title}`,\r\n                id: meeting.id,\r\n                className: 'succes',\r\n              };\r\n              return true;\r\n            });\r\n            return (\r\n              <tr key={timeObj.id}>\r\n                <td>{timeObj.name}</td>\r\n                {days.map((day, index) => (\r\n                  <td key={day.id || index} className={styles.td}>\r\n                    {day.name || ''}\r\n                    {day.name && (\r\n                      <Button\r\n                        key={day.id}\r\n                        data-id={day.id}\r\n                        variant=\"info\"\r\n                        disabled={!user.isAdmin}\r\n                        onClick={e => deleteEvent(e)}\r\n                        className={styles.deleteBtn}\r\n                      >\r\n                        x\r\n                      </Button>\r\n                    )}\r\n                  </td>\r\n                ))}\r\n              </tr>\r\n            );\r\n          })}\r\n        </tbody>\r\n      </Table>\r\n      {modalShow && (\r\n        <CreateEventView\r\n          modalShow={modalShow}\r\n          handleSubmit={handleSubmit}\r\n          handleClose={handleModalClose}\r\n          controlOptions={{ participants, daysArray, timeArray }}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\nMainView.propTypes = {\r\n  user: PropTypes.object,\r\n};\r\n"]},"metadata":{},"sourceType":"module"}